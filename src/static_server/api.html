<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Togetherness</title>
</head>

<body>
    <h1>Togetherness: Back</h1>

    <h2>Available API</h2>
    <ol>
        <li><code>GET /api/timer -> {seconds, error}</code>
            — получаем время до окончания игры, либо ошибку, если игра ещё не началась или уже закончилась</li>
        <li><code>POST /api/player {player={id, name, avatar_id, faction_id}} -> {ok, error}</code>
            — регистрируем игрока</li>
        <li><code>GET /api/player/:id -> {player, error}</code>
            — получаем данные игрока-объекта при взаимодействии</li>
        <li><code>POST /api/action {action={subject_id, object_id, action_id}} -> {ok, error}</code>
            — взаимодействуем</li>
        <li><code>GET /api/action[?subject_id=id][&object_id=id][&action_id=id] -> {count, error}</code>
            — показываем количество взаимодействий. Параметры <code>subject_id</code>, <code>object_id</code> и
            <code>action_id</code> работают как фильтр пересечения (логическое «И»). Примеры использования:
            <ul>
                <li><code>?subject_id=id&object_id=id</code> — если <code>count=1</code>, значит игроки уже
                    взаимодействовали и повторное взаимодействие (в этих же ролях) запрещено</li>
                <li><code>?subject_id=id&action_id=id</code> — показать игроку, сколько раз он совершал действия этого
                    типа</li>
                <li><code>?object_id=id</code> — показать игроку, сколько раз он был жертвой действий любого типа</li>
            </ul>
        </li>
        <li><code>GET /api/gold/:id -> {count, error}</code>
            — показываем количество золота</li>
    </ol>

    <h2>Possible Errors</h2>
    <p>В случае успеха <code>error=None</code>.</p>
    <ol>
        <li>
            <code>GET /api/timer</code>
            <ul>
                <li><code>NotStarted</code></li>
                <li><code>AlreadyFinished</code></li>
                <li><code>MultiThread</code> — внутренняя ошибка сервера,
                    невозможно прочитать или записать состояние игры из-за проблем с потоками
                </li>
            </ul>
        </li>
        <li>
            <code>POST /api/player</code>
            <ul>
                <li><code>PlayerAlreadyExists</code> — игрок с таким id уже зарегистрирован</li>
                <li><code>MultiThread</code>
            </ul>
        </li>
        <li>
            <code>GET /api/player/:id</code>
            <ul>
                <li><code>PlayerNotFound</code></li>
                <li><code>MultiThread</code>
            </ul>
        </li>
        <li>
            <code>POST /api/action</code>
            <ul>
                <li><code>SubjectNotFound</code> — игрок-субъект с таким id не зарегистрирован</li>
                <li><code>ObjectNotFound</code> — игрок-объект с таким id не зарегистрирован</li>
                <li><code>ActionNotFound</code> — некорректный id взаимодействия // пока не реализовано, вызывает
                    падение сервера</li>
                <li><code>AlreadyActed</code> — игроки уже взаимодействовали в этих ролях</li>
                <li><code>MultiThread</code>
            </ul>
        </li>
        <li>
            <code>GET /api/action[?subject_id=id][&object_id=id][&action_id=id]</code>
            <ul>
                <li><code>SubjectNotFound</code></li>
                <li><code>ObjectNotFound</code></li>
                <li><code>ActionNotFound</code> // пока не реализовано, вызывает падение сервера</li>
                <li><code>MultiThread</code>
            </ul>
        </li>
        <li>
            <code>GET /api/gold/:id</code>
            <ul>
                <li><code>PlayerNotFound</code></li>
                <li><code>MultiThread</code>
            </ul>
        </li>
    </ol>
</body>

</html>
